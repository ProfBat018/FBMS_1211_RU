# Тема урока. 
* Multistage build
* Docker vnetwork
* Docker compose


# Multistage build

## Что такое Multistage build ?
Multistage build - это возможность создавать образы, которые состоят из нескольких этапов. Предположим, что нам надо собрать два проекта на .NET Core, один из которых является веб-приложением, а второй консольным приложением. Для этого нам надо создать два образа, которые будут содержать в себе все необходимые зависимости для сборки проектов. Но, если мы будем использовать обычный докерфайл, то мы получим два образа, которые будут содержать в себе все зависимости, которые нам необходимы для сборки проектов. Но, если мы будем использовать Multistage build, то мы получим два образа, которые будут содержать в себе только те зависимости, которые нам необходимы для запуска приложений.

Например .NET проект находится по пути /work/app, а веб-приложение по пути /work/webapp. Тогда докерфайл будет выглядеть следующим образом:

```dockerfile

# Сборка проекта
FROM mcr.microsoft.com/dotnet/core/sdk:7.0 
COPY . /work/app as build-env
WORKDIR /work/app
RUN dotnet publish -c Release -o out

# Запуск приложения
FROM mcr.microsoft.com/dotnet/core/aspnet:7.0  
COPY --from=build-env /work/app/out /work/webapp
WORKDIR /work/webapp
ENTRYPOINT ["dotnet", "webapp.dll"]

```

## Как это работает ?

Когда мы запускаем команду docker build, то Docker собирает все слои, которые находятся в докерфайле. Но, если в докерфайле есть несколько FROM, то Docker собирает только те слои, которые находятся после последней команды FROM. То есть, в нашем случае Docker соберет только те слои, которые находятся после команды FROM mcr.microsoft.com/dotnet/core/aspnet:7.0. Таким образом, мы получим два образа, которые будут содержать в себе только те зависимости, которые нам необходимы для запуска приложений.


## Docker Compose 

Compose - он исходит из слова composition, что в переводе означает композиция.

Docker Compose - это очень удобный инструмент, который позволяет запускать несколько контейнеров одновременно. Например, если мы хотим запустить приложение на .NET Core, то нам надо сначала запустить контейнер с базой данных, а затем запустить контейнер с приложением. Но, если мы будем использовать Docker Compose, то мы сможем запустить оба контейнера одной командой.

