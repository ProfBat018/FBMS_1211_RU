<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <!-- sp=racwl&st=2023-04-27T17:24:12Z&se=2023-04-28T01:24:12Z&sv=2021-12-02&sr=c&sig=bItH9eQEjcEcO2xYGDkFTLBADOKyVW%2FXn6Y0ZpG3MGY%3D -->

    <!-- https://nightcall.blob.core.windows.net/images?sp=racwl&st=2023-04-27T17:24:12Z&se=2023-04-28T01:24:12Z&sv=2021-12-02&sr=c&sig=bItH9eQEjcEcO2xYGDkFTLBADOKyVW%2FXn6Y0ZpG3MGY%3D -->


    <script>

        // connect-with-sas-token.js
        const { BlobServiceClient } = require('@azure/storage-blob');
        require('dotenv').config()

        const accountName = process.env.AZURE_STORAGE_ACCOUNT_NAME;
        const sasToken = process.env.AZURE_STORAGE_SAS_TOKEN;
        if (!accountName) throw Error('Azure Storage accountName not found');
        if (!sasToken) throw Error('Azure Storage accountKey not found');

        const blobServiceUri = `https://${accountName}.blob.core.windows.net`;

        // https://YOUR-RESOURCE-NAME.blob.core.windows.net?YOUR-SAS-TOKEN
        const blobServiceClient = new BlobServiceClient(
            `${blobServiceUri}?${sasToken}`,
            null
        );

        async function main() {

            const containerName = 'REPLACE-WITH-EXISTING-CONTAINER-NAME';
            const blobName = 'REPLACE-WITH-EXISTING-BLOB-NAME';

            const timestamp = Date.now();
            const fileName = `my-new-file-${timestamp}.txt`;

            // create container client
            const containerClient = await blobServiceClient.getContainerClient(containerName);

            // create blob client
            const blobClient = await containerClient.getBlockBlobClient(blobName);

            // download file
            await blobClient.downloadToFile(fileName);

            console.log(`${fileName} downloaded`);

        }

        main()
            .then(() => console.log(`done`))
            .catch((ex) => console.log(`error: ${ex.message}`));
    </script>
</body>
</html>